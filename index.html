<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>VÃ²ng quay mÃ³n Äƒn</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      padding: 30px;
      background-image: url('https://cdn.tgdd.vn/2021/06/CookProduct/BeFunky-collage-1200x676-2.jpg');
      background-size: cover;
      background-repeat: no-repeat;
      background-position: center;
      color: white;
      min-height: 100vh;
      margin: 0;
      display: flex;
      flex-direction: column;
      justify-content: center;
    }
    h1 {
      background-color: rgba(0, 0, 0, 0.6);
      padding: 10px;
      border-radius: 10px;
      display: inline-block;
    }
    button {
      font-size: 18px;
      padding: 10px 20px;
      margin: 10px;
      border: none;
      border-radius: 8px;
      background-color: #ff9800;
      color: white;
      cursor: pointer;
      min-width: 120px;
    }
    button:hover {
      background-color: #f57c00;
    }
    .result {
      font-size: 24px;
      margin-top: 20px;
      background-color: rgba(0, 0, 0, 0.5);
      display: inline-block;
      padding: 10px 20px;
      border-radius: 10px;
      min-width: 280px;
      min-height: 40px;
      line-height: 40px;
    }
    #history {
      max-width: 600px;
      margin: 30px auto 0;
      background-color: rgba(0,0,0,0.5);
      padding: 15px;
      border-radius: 10px;
      text-align: left;
      color: #fff;
      overflow-y: auto;
      max-height: 200px;
    }
    #history ul {
      padding-left: 20px;
      margin: 0;
    }
    #refreshBtn {
      position: fixed;
      bottom: 15px;
      right: 15px;
      background-color: #555;
      font-size: 14px;
      padding: 6px 10px;
      border-radius: 5px;
      min-width: auto;
      opacity: 0.7;
      transition: opacity 0.3s;
    }
    #refreshBtn:hover {
      opacity: 1;
    }
    #saveBtn {
      background-color: #4caf50;
      min-width: 140px;
    }
    #saveBtn:hover {
      background-color: #388e3c;
    }
    @media (max-width: 480px) {
      .result {
        min-width: 90vw;
        font-size: 20px;
      }
      button {
        min-width: 90vw;
        font-size: 20px;
      }
      #history {
        max-width: 90vw;
      }
    }
  </style>
</head>
<body>
  <h1>ðŸŽ¯ VÃ²ng quay mÃ³n Äƒn ðŸŽ¯</h1>

  <div>
    <button onclick="spin('máº·n')">MÃ³n máº·n</button>
    <div id="result-máº·n" class="result"></div>
  </div>

  <div>
    <button onclick="spin('canh')">MÃ³n canh</button>
    <div id="result-canh" class="result"></div>
  </div>

  <div>
    <button id="saveBtn" onclick="saveMenu()">LÆ°u thá»±c Ä‘Æ¡n cho ngÃ y mai</button>
  </div>

  <div id="history">
    <h3>Lá»‹ch sá»­ thá»±c Ä‘Æ¡n Ä‘Ã£ lÆ°u</h3>
    <ul id="historyList">
      <li>ChÆ°a cÃ³ thá»±c Ä‘Æ¡n nÃ o Ä‘Æ°á»£c lÆ°u.</li>
    </ul>
  </div>

  <button id="refreshBtn" onclick="resetAll()">LÃ m má»›i</button>

  <script>
    const data = {
      "máº·n": [
        "Äáº­u phá»¥ sá»‘t cÃ  chua",
        "Äáº­u phá»¥ nhá»“i thá»‹t bÄƒm háº¥p hoáº·c sá»‘t",
        "Äáº­u phá»¥ kho náº¥m Ä‘Ã´ng cÃ´",
        "Äáº­u phá»¥ chiÃªn giÃ²n cháº¥m nÆ°á»›c tÆ°Æ¡ng",
        "Äáº­u phá»¥ rim máº·n ngá»t",
        "Äáº­u phá»¥ xÃ o náº¥m vÃ  hÃ nh lÃ¡",
        "Thá»‹t bÄƒm xÃ o náº¥m hÆ°Æ¡ng",
        "Náº¥m Ä‘Ã¹i gÃ  xÃ o thá»‹t bÄƒm",
        "Náº¥m kho tiÃªu vá»›i thá»‹t bÄƒm",
        "Trá»©ng háº¥p thá»‹t bÄƒm vÃ  náº¥m",
        "Náº¥m xÃ o bÆ¡ tá»i",
        "Thá»‹t bÄƒm rang sáº£ á»›t",
        "Thá»‹t bÄƒm rim nÆ°á»›c máº¯m tá»i",
        "Trá»©ng chiÃªn thá»‹t bÄƒm",
        "Thá»‹t bÄƒm xÃ o Ä‘áº­u que",
        "Thá»‹t bÄƒm xÃ o su su / cÃ  rá»‘t",
        "Báº§u nhá»“i thá»‹t bÄƒm sá»‘t nÆ°á»›c tÆ°Æ¡ng",
        "Ruá»‘c náº¥m"
      ],
      "canh": [
        "Canh náº¥m rÆ¡m náº¥u thá»‹t bÄƒm",
        "Canh náº¥m kim chÃ¢m thá»‹t bÄƒm",
        "Canh bÃ­ Ä‘á» thá»‹t bÄƒm",
        "Canh cáº£i bÃ³ xÃ´i náº¥u thá»‹t bÄƒm",
        "Canh cáº£i ngá»t thá»‹t bÄƒm",
        "Canh cáº£i tháº£o thá»‹t bÄƒm",
        "Canh má»“ng tÆ¡i náº¥u tÃ´m khÃ´ (hoáº·c thá»‹t bÄƒm)",
        "Canh rong biá»ƒn thá»‹t bÄƒm vÃ  Ä‘áº­u phá»¥",
        "Canh bÃ­ xanh nhá»“i thá»‹t bÄƒm",
        "Canh Ä‘áº­u phá»¥ non vÃ  thá»‹t bÄƒm",
        "Canh cá»§ cáº£i tráº¯ng náº¥u thá»‹t bÄƒm",
        "Canh náº¥m Ä‘Ã¹i gÃ  náº¥u rau cáº£i"
      ]
    };

    let selected = { "máº·n": undefined, "canh": undefined };
    let filteredData = { "máº·n": [...data["máº·n"]], "canh": [...data["canh"]] };
    let baseDate = null; // ngÃ y báº¯t Ä‘áº§u lÆ°u lá»‹ch sá»­

    function spin(type) {
      if (filteredData[type].length === 0) {
        alert(`KhÃ´ng cÃ²n mÃ³n ${type} Ä‘á»ƒ quay!`);
        return;
      }
      const items = filteredData[type];
      const result = items[Math.floor(Math.random() * items.length)];
      selected[type] = result;
      document.getElementById("result-" + type).innerText = "ðŸ‘‰ " + result;

      // Loáº¡i bá» mÃ³n vá»«a chá»n khá»i danh sÃ¡ch Ä‘á»ƒ khÃ´ng chá»n láº¡i
      filteredData[type] = filteredData[type].filter(i => i !== result);
    }

    function formatDateWithWeekday(dateString) {
      const days = ['Chá»§ Nháº­t', 'Thá»© 2', 'Thá»© 3', 'Thá»© 4', 'Thá»© 5', 'Thá»© 6', 'Thá»© 7'];
      const d = new Date(dateString);
      const weekday = days[d.getDay()];
      const day = String(d.getDate()).padStart(2, '0');
      const month = String(d.getMonth() + 1).padStart(2, '0');
      const year = d.getFullYear();
      return `${weekday}, ${day}/${month}/${year}`;
    }

    function loadHistory() {
      const raw = localStorage.getItem("menuHistory");
      return raw ? JSON.parse(raw) : [];
    }

    function saveHistory(history) {
      localStorage.setItem("menuHistory", JSON.stringify(history));
    }

    function renderHistory() {
      const history = loadHistory();
      const ul = document.getElementById("historyList");
      ul.innerHTML = "";
      if (history.length === 0) {
        ul.innerHTML = "<li>ChÆ°a cÃ³ thá»±c Ä‘Æ¡n nÃ o Ä‘Æ°á»£c lÆ°u.</li>";
        return;
      }
      history.forEach(item => {
        if (!item.monMan || !item.monCanh) return;
        const li = document.createElement("li");
        li.textContent = `${formatDateWithWeekday(item.date)} - Em Mia Iu chá»n mÃ³n: MÃ³n máº·n: ${item.monMan}; MÃ³n canh: ${item.monCanh}`;
        ul.appendChild(li);
      });
    }

    function saveMenu() {
      if (!selected["máº·n"] || !selected["canh"]) {
        alert("Vui lÃ²ng chá»n cáº£ mÃ³n máº·n vÃ  mÃ³n canh trÆ°á»›c khi lÆ°u!");
        return;
      }
      let history = loadHistory();

      // Náº¿u chÆ°a cÃ³ lá»‹ch sá»­, láº¥y ngÃ y hiá»‡n táº¡i +1 ngÃ y, ngÆ°á»£c láº¡i láº¥y ngÃ y lá»›n nháº¥t +1
      if (!baseDate) {
        const now = new Date();
        baseDate = new Date(now.getFullYear(), now.getMonth(), now.getDate() + 1);
      } else {
        baseDate = new Date(baseDate.getFullYear(), baseDate.getMonth(), baseDate.getDate() + 1);
      }

      const dateStr = baseDate.toISOString().slice(0, 10);

      history.push({
        date: dateStr,
        monMan: selected["máº·n"],
        monCanh: selected["canh"]
      });

      saveHistory(history);

      // Reset danh sÃ¡ch mÃ³n quay láº¡i Ä‘á»§ Ä‘á»ƒ chá»n tiáº¿p
      filteredData = { "máº·n": [...data["máº·n"]], "canh": [...data["canh"]] };
      selected = { "máº·n": undefined, "canh": undefined };
      document.getElementById("result-máº·n").innerText = "";
      document.getElementById("result-canh").innerText = "";

      renderHistory();
      alert("ÄÃ£ lÆ°u thá»±c Ä‘Æ¡n cho " + formatDateWithWeekday(dateStr));
    }

    function resetAll() {
      if (confirm("Báº¡n cÃ³ cháº¯c muá»‘n lÃ m má»›i vÃ  xÃ³a lá»‹ch sá»­?")) {
        localStorage.removeItem("menuHistory");
        filteredData = { "máº·n": [...data["máº·n"]], "canh": [...data["canh"]] };
        selected = { "máº·n": undefined, "canh": undefined };
        baseDate = null;
        document.getElementById("result-máº·n").innerText = "";
        document.getElementById("result-canh").innerText = "";
        renderHistory();
      }
    }

    window.onload = function () {
      renderHistory();

      // Thiáº¿t láº­p baseDate theo lá»‹ch sá»­ Ä‘á»ƒ khÃ´ng bá»‹ reset ngÃ y
      const history = loadHistory();
      if (history.length > 0) {
        const lastDate = history[history.length - 1].date;
        baseDate = new Date(lastDate);
      }
    };
  </script>
</body>
</html>
